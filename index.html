<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
        integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        #color_display {
            display: none;
            width: 100%;
            height: 200px;
            position: relative;
            top: 0;
            left: 0;
            z-index: 100;
        }

        #old_color {
            width: 20%;
            height: 100%;
            float: left;
        }

        #new_color {
            width: 20%;
            height: 100%;
            float: left;
        }

        #picker_box {
            margin: 10px;
        }
    </style>
</head>

<body style="overflow: hidden;">
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-3">
                <ul class="nav nav-tabs" id="myTab" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="file-tab" data-bs-toggle="tab" data-bs-target="#file"
                            type="button" role="tab" aria-controls="file" aria-selected="true"
                            onclick="mode = 'file'; update_download()">
                            File
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="planning-tab" data-bs-toggle="tab" data-bs-target="#planning"
                            type="button" role="tab" aria-controls="planning" aria-selected="true"
                            onclick="mode = 'planning'">
                            Planning
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="drawing-tab" data-bs-toggle="tab" data-bs-target="#drawing"
                            type="button" role="tab" aria-controls="drawing" aria-selected="false"
                            onclick="mode = 'drawing'">
                            Drawing
                        </button>
                    </li>
                </ul>

                <div class="tab-content vh-100" id="myTabContent">
                    <div class="tab-pane fade show active" id="file" role="tabpanel" aria-labelledby="file-tab">
                        <div class="mb-3">
                            <div class="card m-1">
                                <div class="card-header d-flex justify-content-between">
                                    <span class="fs-4"> Pesistence </span>
                                </div>
                                <div class="card-body">
                                    <input class="form-control" type="file" id="file_input">

                                    <a id="saveButton" class="btn btn-primary mt-2">
                                        save as...
                                    </a>
                                </div>
                            </div>

                            <div class="card m-1">
                                <div class="card-header d-flex justify-content-between">
                                    <span class="fs-4"> Options </span>
                                </div>
                                <div class="card-body">

                                    <div class=" d-inline-flex align-items-center">

                                        <label class="form-label" style="min-width: 100px !important">Tile Size (px):
                                        </label>
                                        <input type="text" class="form-control" id="tilesize_input" style="width: 40%">
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="planning" role="tabpanel" aria-labelledby="planning-tab">

                        <div class="card m-1">
                            <div class="card-header d-flex justify-content-between">
                                <span class="fs-4"> Tiles </span>

                                <div class="btn-group rm-auto" role="group" aria-label="Basic example">
                                    <button type="button" id="add_button" class="btn btn-secondary"
                                        onclick="add_palette_item()">
                                        <i class="fa fa-plus" aria-hidden="true"></i>
                                    </button>

                                </div>
                            </div>
                            <div class="card-body">
                                <ul class="list-group">
                                    <li class="list-group-item">Cras justo odio</li>
                                    <li class="list-group-item">Dapibus ac facilisis in</li>
                                    <li class="list-group-item">Morbi leo risus</li>
                                    <li class="list-group-item">Porta ac consectetur ac</li>
                                    <li class="list-group-item">Vestibulum at eros</li>
                                </ul>
                            </div>
                        </div>

                        <div class="card m-1">
                            <div class="card-header d-flex justify-content-between">

                                <span class="fs-4"> Scenes </span>

                                <div class="btn-group rm-auto" role="group" aria-label="Basic example">
                                    <button type="button" id="add_button" class="btn btn-secondary"
                                        onclick="add_palette_item()">
                                        <i class="fa fa-plus" aria-hidden="true"></i>
                                    </button>

                                </div>

                            </div>
                            <div class="card-body">
                                <ul class="list-group">
                                    <li class="list-group-item">Cras justo odio</li>
                                    <li class="list-group-item">Dapibus ac facilisis in</li>
                                    <li class="list-group-item">Morbi leo risus</li>
                                    <li class="list-group-item">Porta ac consectetur ac</li>
                                    <li class="list-group-item">Vestibulum at eros</li>
                                </ul>
                            </div>
                        </div>

                    </div>
                    <div class="tab-pane fade" id="drawing" role="tabpanel" aria-labelledby="drawing-tab">
                        <div class="card m-1 ">

                            <div id="picker_box" class="d-flex justify-content-center overflow-hidden">
                                <div id="picker"></div>
                            </div>


                        </div>


                        <div class="card m-1">
                            <div class="card-header d-flex justify-content-between">
                                <span class="fs-4"> Palette </span>

                                <div class="btn-group rm-auto" role="group" aria-label="Basic example">
                                    <button type="button" id="add_button" class="btn btn-secondary"
                                        onclick="add_palette_item()">
                                        <i class="fa fa-plus" aria-hidden="true"></i>
                                    </button>
                                    <button type="button" id="delete_button" class="btn btn-secondary"
                                        onclick="delete_palette_item()" disabled>
                                        <i class="fa fa-trash" aria-hidden="true"></i>
                                    </button>
                                    <button type="button" id="deselect_button" class="btn btn-secondary"
                                        onclick="deselect_palette_item()" disabled>
                                        <i class="fa fa-minus-square" aria-hidden="true"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="card-body">


                                <div class="overflow-auto" style="height: 45vh;">
                                    <div class="d-flex p-2 flex-wrap justify-content-center" id="palette">

                                    </div>
                                </div>
                            </div>
                        </div>



                    </div>
                </div>
            </div>
            <div class="col-md-9 h-100 vh-100">
                <div id="color_display">
                    <div id="old_color"></div>
                    <div id="new_color"></div>
                </div><canvas id="canvas" class="w-100 h-100 "></canvas>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@jaames/iro@5"></script>

    <script>
        const deselect_button = document.getElementById("deselect_button")
        const delete_button = document.getElementById("delete_button")
        const add_button = document.getElementById("add_button")
        const saveButton = document.getElementById("saveButton")

    </script>

    <script>
        let project = {};
    </script>

    <script src="color_system.js"></script>
    <script>


        let mode = "draw"

        function update_download() {
            var dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(project));
            saveButton.setAttribute("href", dataStr);
            saveButton.setAttribute("download", "scene.json");
        }

        const file_input = document.getElementById("file_input")
        const tilesize_input = document.getElementById("tilesize_input");

        function load_file() {
            let file = file_input.files[0];
            let reader = new FileReader();

            reader.readAsText(file);

            reader.onload = function () {
                let text = reader.result

                console.log("loading:", text);

                project = JSON.parse(text);

                if (!project.parameters) project.parameters = {};
                tilesize_input.value = project.parameters.tilesize

                update_download()
            };

        }

        file_input.addEventListener("input", load_file);

        function update_tile_size() {

            if (!project.parameters) project.parameters = {};
            project.parameters.tilesize = tilesize_input.value;

            update_download()
        }
        tilesize_input.addEventListener("input", update_tile_size);


    </script>
</body>

</html>